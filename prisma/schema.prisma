// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema
// Add to settings.json to format on save
//  "[prisma]": {
//    "editor.defaultFormatter": "Prisma.prisma",
//    "editor.formatOnSave": true
//  }
generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "esm"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator erd {
  provider = "prisma-erd-generator"
  output   = "./prisma/ERD.svg" // png/pdf also supported
}

model User {
  id        Int      @id @default(autoincrement())
  clerkId   String   @unique
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  Groups  Group[]
  borrowedDebts Debt[]          @relation("BorrowedDebts")
  lentDebts     Debt[]          @relation("LentDebts")
  leaderGoals   Goal[]          @relation("LeaderGoals")
  goalProgress  GoalProgress[] @relation("UserGoalProgress")
}

model Group {
  id        Int      @id @default(autoincrement())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users User[]
  debts   Debt[]
  goals   Goal[]
}

// User and Group have a many-to-many relationship 
//so prisma will create a join table automatically

enum DebtStatus {
  PENDING
  PAID
  OVERDUE
  FORGIVEN
}

model Debt {
  id          Int        @id @default(autoincrement())
  amount      Float
  description String
  status      DebtStatus @default(PENDING)
  receiptUrl  String? //do we need this?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  GroupId Int
  Group   Group @relation(fields: [GroupId], references: [id])

  borrowerId Int
  borrower   User @relation("BorrowedDebts", fields: [borrowerId], references: [id])

  lenderId Int
  lender   User @relation("LentDebts", fields: [lenderId], references: [id])
}

model Goal {
  id          Int      @id @default(autoincrement())
  name        String
  description String
  target      Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  leaderId Int
  leader   User @relation("LeaderGoals", fields: [leaderId], references: [id])

  GroupId Int
  Group   Group @relation(fields: [GroupId], references: [id])

  progress GoalProgress[]
}

model GoalProgress {
  id          Int      @id @default(autoincrement())
  amount      Float    @default(0)
  target      Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  goalId Int
  goal   Goal @relation(fields: [goalId], references: [id])

  userId Int
  user   User @relation("UserGoalProgress", fields: [userId], references: [id])

  @@unique([goalId, userId])
}
